{% extends "base.html" %}

{% block title %}README Generator - {{ project_name }}{% endblock %}

{% block content %}
<div class="readme-generator-page">
    <header class="page-header">
        <h1>README Generator</h1>
        <p class="subtitle">Create professional README.md with smart detection and interactive tools</p>
    </header>

    <div class="tool-container">
        <!-- Step 1: Project Detection -->
        <section class="section card">
            <h2>[1/4] Project Detection</h2>
            <p>Auto-detect your project type, languages, and frameworks</p>
            <button id="detectProjectBtn" class="btn btn-primary">
                <span class="btn-icon">[>>]</span> Detect Project
            </button>
            <div id="detectionResult" class="result-box" style="display: none;">
                <h3>Detection Results:</h3>
                <div id="detectionData"></div>
            </div>
        </section>

        <!-- Step 2: README Form -->
        <section class="section card">
            <h2>[2/4] Project Information</h2>
            <form id="readmeForm">
                <div class="form-group">
                    <label for="projectName">Project Name *</label>
                    <input type="text" id="projectName" name="projectName" required placeholder="My Awesome Project">
                </div>

                <div class="form-group">
                    <label for="description">Description *</label>
                    <textarea id="description" name="description" rows="3" required placeholder="A comprehensive tool for..."></textarea>
                </div>

                <div class="form-group">
                    <label for="features">Features (one per line)</label>
                    <textarea id="features" name="features" rows="5" placeholder="Feature 1&#10;Feature 2&#10;Feature 3"></textarea>
                </div>

                <div class="form-group">
                    <label for="installation">Installation Instructions</label>
                    <textarea id="installation" name="installation" rows="4" placeholder="git clone...&#10;npm install"></textarea>
                </div>

                <div class="form-group">
                    <label for="usage">Usage Instructions</label>
                    <textarea id="usage" name="usage" rows="4" placeholder="npm start&#10;or&#10;python main.py"></textarea>
                </div>

                <div class="form-group">
                    <label for="license">License</label>
                    <select id="license" name="license">
                        <option value="MIT">MIT</option>
                        <option value="Apache-2.0">Apache 2.0</option>
                        <option value="GPL-3.0">GPL 3.0</option>
                        <option value="BSD-3-Clause">BSD 3-Clause</option>
                        <option value="ISC">ISC</option>
                    </select>
                </div>

                <button type="submit" class="btn btn-primary">
                    <span class="btn-icon">[ROCKET]</span> Generate README
                </button>
            </form>
        </section>

        <!-- Step 3: Preview -->
        <section class="section card" id="previewSection" style="display: none;">
            <h2>[3/4] README Preview</h2>
            <div class="preview-actions">
                <button class="btn btn-secondary" id="downloadReadme">
                    <span class="btn-icon">[PKG]</span> Download README.md
                </button>
                <button class="btn btn-secondary" id="copyReadme">
                    <span class="btn-icon">[*]</span> Copy to Clipboard
                </button>
            </div>
            <pre><code id="readmeContent" class="markdown"></code></pre>
        </section>

        <!-- Step 4: Next Steps -->
        <section class="section card" id="nextStepsSection" style="display: none;">
            <h2>[4/4] Next Steps</h2>
            <div class="next-steps">
                <p>[OK] README.md generated successfully!</p>
                <ul>
                    <li>[>>] Save README.md to your repository root</li>
                    <li>[>>] Check repository health: <a href="/health-checker">Run Health Check</a></li>
                    <li>[>>] Generate wiki pages: <a href="/wiki-generator">Create Wiki</a></li>
                    <li>[>>] Complete setup: <a href="/setup-wizard">Setup Wizard</a></li>
                </ul>
            </div>
        </section>
    </div>
</div>

<style>
.readme-generator-page {
    max-width: 1200px;
    margin: 0 auto;
}

.tool-container {
    display: flex;
    flex-direction: column;
    gap: 2rem;
}

.card {
    background: var(--card-bg);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    padding: 2rem;
}

.form-group {
    margin-bottom: 1.5rem;
}

.form-group label {
    display: block;
    margin-bottom: 0.5rem;
    color: var(--text-primary);
    font-weight: 500;
}

.form-group input[type="text"],
.form-group select,
.form-group textarea {
    width: 100%;
    padding: 0.75rem;
    background: var(--dark-bg);
    border: 1px solid var(--border-color);
    border-radius: 4px;
    color: var(--text-primary);
    font-family: inherit;
}

.btn {
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: 4px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s;
}

.btn-icon {
    margin-right: 0.5rem;
}

.btn-primary {
    background: var(--primary-color);
    color: var(--dark-bg);
}

.btn-primary:hover {
    background: var(--secondary-color);
}

.btn-secondary {
    background: var(--card-bg);
    color: var(--text-primary);
    border: 1px solid var(--border-color);
    margin-right: 0.5rem;
}

.btn-secondary:hover {
    border-color: var(--primary-color);
}

.result-box {
    margin-top: 1rem;
    padding: 1rem;
    background: var(--darker-bg);
    border: 1px solid var(--border-color);
    border-radius: 4px;
}

.preview-actions {
    margin-bottom: 1rem;
}

pre {
    background: var(--darker-bg);
    border: 1px solid var(--border-color);
    border-radius: 4px;
    padding: 1rem;
    overflow-x: auto;
    max-height: 500px;
}

code {
    color: var(--text-primary);
    font-family: 'Courier New', monospace;
}

.next-steps ul {
    list-style: none;
    padding-left: 0;
}

.next-steps li {
    margin: 0.5rem 0;
    padding: 0.5rem;
    background: var(--darker-bg);
    border-radius: 4px;
}

.next-steps a {
    color: var(--primary-color);
    text-decoration: none;
}

.next-steps a:hover {
    text-decoration: underline;
}
</style>

<script>
// Detect project
document.getElementById('detectProjectBtn').addEventListener('click', async () => {
    try {
        const response = await fetch('/api/detect-project', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' }
        });

        const result = await response.json();

        if (result.success) {
            const data = result.data;
            document.getElementById('detectionResult').style.display = 'block';
            document.getElementById('detectionData').innerHTML = `
                <p><strong>Detected Type:</strong> ${data.detected_type || 'Unknown'}</p>
                <p><strong>Confidence:</strong> ${(data.confidence * 100).toFixed(1)}%</p>
                <p><strong>Languages:</strong> ${Object.keys(data.languages || {}).join(', ') || 'None'}</p>
                <p><strong>Frameworks:</strong> ${(data.frameworks || []).join(', ') || 'None'}</p>
                <p><strong>Technologies:</strong> ${(data.technologies || []).join(', ') || 'None'}</p>
            `;

            // Auto-fill form if detected
            if (data.detected_type) {
                document.getElementById('projectName').value = data.detected_type.replace(/-/g, ' ').toUpperCase();
            }

            showNotification('Project detected successfully!', 'success');
        } else {
            showNotification('Failed to detect project: ' + result.error, 'error');
        }
    } catch (error) {
        showNotification('Error: ' + error.message, 'error');
    }
});

// Generate README
document.getElementById('readmeForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    const formData = new FormData(e.target);
    const features = formData.get('features').split('\n').filter(f => f.trim());

    const data = {
        projectName: formData.get('projectName'),
        description: formData.get('description'),
        features: features,
        installation: formData.get('installation'),
        usage: formData.get('usage'),
        license: formData.get('license')
    };

    try {
        const response = await fetch('/api/generate-readme', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        });

        const result = await response.json();

        if (result.success) {
            document.getElementById('readmeContent').textContent = result.content;
            document.getElementById('previewSection').style.display = 'block';
            document.getElementById('nextStepsSection').style.display = 'block';

            // Scroll to preview
            document.getElementById('previewSection').scrollIntoView({ behavior: 'smooth' });

            showNotification('README generated successfully!', 'success');
        } else {
            showNotification('Failed to generate README: ' + result.error, 'error');
        }
    } catch (error) {
        showNotification('Error: ' + error.message, 'error');
    }
});

// Download README
document.getElementById('downloadReadme').addEventListener('click', () => {
    const content = document.getElementById('readmeContent').textContent;
    const blob = new Blob([content], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'README.md';
    a.click();
    URL.revokeObjectURL(url);
    showNotification('README.md downloaded!', 'success');
});

// Copy README
document.getElementById('copyReadme').addEventListener('click', async () => {
    const content = document.getElementById('readmeContent').textContent;
    await navigator.clipboard.writeText(content);
    showNotification('README copied to clipboard!', 'success');
});

function showNotification(message, type) {
    if (window.GitSage && window.GitSage.showNotification) {
        window.GitSage.showNotification(message, type);
    } else {
        alert(message);
    }
}
</script>
{% endblock %}
